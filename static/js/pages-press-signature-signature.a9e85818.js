(self["webpackChunkpress_ui_demo_vue2"]=self["webpackChunkpress_ui_demo_vue2"]||[]).push([[2399],{1540:function(t,e,n){var i=n(581);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var a=n(75970).A;a("d512a79e",i,!0,{sourceMap:!1,shadowMode:!1})},61093:function(t,e,n){var i=n(48410);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var a=n(75970).A;a("096ed921",i,!0,{sourceMap:!1,shadowMode:!1})},25035:function(t,e,n){"use strict";var i;n.r(e),n.d(e,{default:function(){return j}});var a,s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"demo-wrap"},[n("demo-block",{attrs:{title:t.t("basicUsage"),"section-style":t.sectionStyle,"custom-style":t.customStyle}},[n("PressSignature",{ref:"pressSignature",attrs:{"pen-color":t.customInfo["pen-color"],"line-width":t.customInfo["line-width"],"background-color":t.customInfo["background-color"]},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.onSubmit.apply(void 0,arguments)},clear:function(e){arguments[0]=e=t.$handleEvent(e),t.onClear.apply(void 0,arguments)}}}),n("div",{staticClass:"image-wrap"},[t.image?n("PressImage",{attrs:{src:t.image,width:t.canvasWidth,height:t.canvasHeight}}):t._e()],1)],1),n("PressGrid",{attrs:{clickable:!0,"column-num":3}},[n("PressGridItem",{attrs:{text:t.t("penColor"),icon:"edit"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"pen-color":"#ff0000"})}}}),n("PressGridItem",{attrs:{text:t.t("lineWidth"),icon:"font-o"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"line-width":6})}}}),n("PressGridItem",{attrs:{text:t.t("backgroundColor"),icon:"photo-o"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"background-color":"#eee"})}}})],1)],1)},r=[],o=n(20731),c=n(27070),u=n(53324),l=n(93022),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"press-signature",class:t.customClass},[n("div",{ref:"wrapRef",staticClass:"press-signature__content",attrs:{id:t.wrapId}},[t.isRenderCanvas?n("Canvas",{ref:"canvasRef",attrs:{id:t.canvasId,type:"2d","canvas-id":t.canvasId},on:{"&touchstart":function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart.apply(void 0,arguments)},touchmove:function(e){e.preventDefault(),e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){e.preventDefault(),e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)}}}):n("p",[t._v(t._s(t.tips))])],1),n("div",{staticClass:"press-signature__footer"},[n("PressButton",{attrs:{"custom-class":"press-signature__button press-signature__button--clear",size:"small"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clear.apply(void 0,arguments)}}},[t._v(t._s(t.clearButtonText||t.t("clear")))]),n("PressButton",{attrs:{"custom-class":"press-signature__button press-signature__submit",type:"primary",size:"small"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v(t._s(t.confirmButtonText||t.t("confirm")))])],1)])},h=[],v=(n(174),n(38469),n(11680),n(98127),n(59803),n(90758)),f=n(80726),p=n(41823),g=n(25595),m=n(89931),x=n(51505),y=n(78428);n(97255),n(16206),n(60671);function C(t,e,n){var i=n.lineColor,a=void 0===i?"#1A1A1A":i,s=n.updateRadius,r=n.radius,o=r,c=60,u=1,l=1.5,d=.5,h=4;if(!(e.length<=1)){var v,f,p,g,m,x,y=0,C=0,_=.5;e.length<=2?(v=e[1].x,g=e[1].y,p=e[1].x+(e[0].x-e[1].x)*_,x=e[1].y+(e[0].y-e[1].y)*_,f=v+(p-v)*_,m=g+(x-g)*_):(v=e[2].x+(e[1].x-e[2].x)*_,g=e[2].y+(e[1].y-e[2].y)*_,f=e[1].x,m=e[1].y,p=f+(e[0].x-f)*_,x=m+(e[0].y-m)*_);for(var P=w({x:p,y:x},{x:v,y:g}),k=o,I=0;I<e.length-1;I++)if(y+=e[I].dis,C+=e[I].time-e[I+1].time,y>c)break;o=Math.min(C/P*u+d,h)*l,s(o),e[0].r=o;for(var A=5,R=[],F=0;F<A;F++){var L=F/(A-1),T=(1-L)*(1-L)*v+2*L*(1-L)*f+L*L*p,W=(1-L)*(1-L)*g+2*L*(1-L)*m+L*L*x,E=k+(o-k)/A*F;if(R.push({x:T,y:W,r:E}),3==R.length){var $=b(R[0].x,R[0].y,R[0].r,R[1].x,R[1].y,R[1].r,R[2].x,R[2].y,R[2].r);$[0].color=a,S(t,$,1),R=[{x:T,y:W,r:E}]}}return e}e[0].r=o}function w(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function b(t,e,n,i,a,s,r,o,c){var u,l,d,h,v,f=[];u=i-t,l=a-e,d=2*Math.sqrt(u*u+l*l+1e-4),u=u/d*n,l=l/d*n;var p=l,g=-u;h=i-r,v=a-o,d=2*Math.sqrt(h*h+v*v+1e-4),h=h/d*c,v=v/d*c;var m=-v,x=h;f.push({mx:t+p,my:e+g,color:"#1A1A1A"}),f.push({c1x:i+p,c1y:a+g,c2x:i+m,c2y:a+x,ex:r+m,ey:o+x}),f.push({c1x:r+m-h,c1y:o+x-v,c2x:r-m-h,c2y:o-x-v,ex:r-m,ey:o-x}),f.push({c1x:i-m,c1y:a-x,c2x:i-p,c2y:a-g,ex:t-p,ey:e-g}),f.push({c1x:t-p-u,c1y:e-g-l,c2x:t+p-u,c2y:e+g-l,ex:t+p,ey:e+g}),f[0].mx=f[0].mx.toFixed(1),f[0].mx=parseFloat(f[0].mx),f[0].my=f[0].my.toFixed(1),f[0].my=parseFloat(f[0].my);for(var y=1;y<f.length;y++)f[y].c1x=f[y].c1x.toFixed(1),f[y].c1x=parseFloat(f[y].c1x),f[y].c1y=f[y].c1y.toFixed(1),f[y].c1y=parseFloat(f[y].c1y),f[y].c2x=f[y].c2x.toFixed(1),f[y].c2x=parseFloat(f[y].c2x),f[y].c2y=f[y].c2y.toFixed(1),f[y].c2y=parseFloat(f[y].c2y),f[y].ex=f[y].ex.toFixed(1),f[y].ex=parseFloat(f[y].ex),f[y].ey=f[y].ey.toFixed(1),f[y].ey=parseFloat(f[y].ey);return f}function S(t,e,n,i){t.beginPath(),t.moveTo(e[0].mx,e[0].my),void 0!=i?(t.setFillStyle(i),t.setStrokeStyle(i)):(t.setFillStyle(e[0].color),t.setStrokeStyle(e[0].color));for(var a=1;a<e.length;a++)t.bezierCurveTo(e[a].c1x,e[a].c1y,e[a].c2x,e[a].c2y,e[a].ex,e[a].ey);t.stroke(),void 0!=n&&t.fill(),t.draw(!0)}var _,P,k=n(98408)["A"],I=function(){var t,e=document.createElement("canvas");return!(null===(t=e.getContext)||void 0===t||!t.call(e,"2d"))},A=0,R={name:"PressSignature",components:{PressButton:x.A},options:{styleIsolation:"shared"},props:{customClass:{type:String,default:""},tips:{type:String,default:""},type:{type:String,default:""},penColor:{type:String,default:"#000"},lineWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#fff"},clearButtonText:{type:String,default:(0,m.t)("clear")},confirmButtonText:{type:String,default:(0,m.t)("confirm")},fileType:{type:String,default:"jpg"}},emits:["start","signing","end","submit","clear"],data:function(){return{canvasRect:{},canvasWidth:0,canvasHeight:0,id:1,inited:!1,ctx:null,wrapId:"pressSignatureWrap",currentLine:[],lastPoint:{},currentPoint:{},radius:1,canvas:null}},computed:{canvasId:function(){var t="press-signature-".concat(this.id);return t},isRenderCanvas:function(){var t=!0;return t=!p.ZK||I(),t},useRawCanvas:function(){var t=!1;return t=!0,(0,f.n1)()&&(t=!0),t}},watch:{windowWidth:function(){this.resize()}},created:function(){A+=1,this.id=A},mounted:function(){this.initialize()},methods:{touchStart:function(t){var e=this;if(!this.ctx)return!1;this.useRawCanvas?(this.ctx.beginPath(),this.ctx.setLineWidth(this.lineWidth),this.ctx.setStrokeStyle(this.penColor)):this.updateCurrentLine(t,!0),(0,v.l)(this,"#".concat(this.canvasId)).then((function(t){e.canvasRect=t,e.$emit("start")}))},pointToLine:function(t){var e=this,n=C(this.ctx,t,{lineColor:this.penColor,updateRadius:function(t){e.radius=t},radius:this.radius,lineWidth:this.lineWidth,penColor:this.penColor});n&&(this.currentLine=n)},updateCurrentLine:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={x:t.changedTouches[0].x,y:t.changedTouches[0].y};this.lastPoint=this.currentPoint,this.currentPoint=n;var i=this.currentLine;i.unshift({time:(new Date).getTime(),dis:e?0:w(this.currentPoint,this.lastPoint),x:n.x,y:n.y}),this.pointToLine(i)},touchMove:function(t){var e,n;if(!this.ctx)return!1;if(null===(e=t.preventDefault)||void 0===e||e.call(t),null===(n=t.stopPropagation)||void 0===n||n.call(t),this.useRawCanvas){var i,a,s=t.touches[0],r=s.clientX-((null===(i=this.canvasRect)||void 0===i?void 0:i.left)||0),o=(0,v.UN)(s.clientY)-((null===(a=this.canvasRect)||void 0===a?void 0:a.top)||0);this.ctx.setLineCap("round"),this.ctx.setLineJoin("round"),this.ctx.lineTo(r,o),this.ctx.stroke(),(0,g.V8)()||this.ctx.draw(!0)}else this.updateCurrentLine(t);this.$emit("signing",t)},touchEnd:function(t){var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.$emit("end"),this.useRawCanvas||(this.updateCurrentLine(t),this.currentLine=[])},submit:function(){var t=this,e=this;if(this.useRawCanvas){var n,i,a=this.$refs.canvasRef;if(!a)return;var s=this.isCanvasEmpty(a),r=s?"":(null===(n=(i={jpg:function(){return a.toDataURL("image/jpeg",.8)},jpeg:function(){return a.toDataURL("image/jpeg",.8)}})[this.type])||void 0===n?void 0:n.call(i))||a.toDataURL("image/".concat(this.type));this.$emit("submit",{image:r,canvas:a,width:this.canvasWidth,height:this.canvasHeight})}else{var o=function(){uni.canvasToTempFilePath({canvas:t.canvas,canvasId:t.canvasId,fileType:t.fileType,quality:1,success:function(t){var n=t.tempFilePath;e.base64(n,"jpg").then((function(t){e.$emit("submit",{image:t,canvas:e.canvas,width:e.canvasWidth,height:e.canvasHeight})}))},fail:function(t){k.warn("[canvasToTempFilePath] error: ",t)}},t)};o()}},base64:function(t,e){return new Promise((function(n,i){uni.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:function(t){n("data:image/".concat(e.toLocaleLowerCase(),";base64,").concat(t.data))},fail:function(){i()}})}))},innerClear:function(){this.ctx&&(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.closePath(),this.ctx.draw(),this.setCanvasBgColor(this.ctx))},clear:function(){this.innerClear(),this.$emit("clear")},initialize:function(){var t=this;this.isRenderCanvas&&this.getContext().then((function(e){t.ctx=e,t.innerClear()}))},getContext:function(){var t=this,e=this;return new Promise((function(n,i){(0,v.l)(t,"#".concat(t.wrapId)).then((function(t){var i=t.width,a=t.height;e.canvasWidth=i,e.canvasHeight=a;var s=e.innerGetContext({width:i,height:a});n(s)})).catch((function(t){i(t)}))}))},innerGetContext:function(t){var e=this,n=t.width,i=t.height,a=function(){var t=window.devicePixelRatio,a=document.getElementById(e.canvasId),s=a.getContext("2d");return e.inited||(e.inited=!0,a.width=n*t,a.height=i*t,s.scale(t,t)),Promise.resolve((0,y.y)(s))};if(this.useRawCanvas)return a();if(!(0,g.V8)()){var s=uni.createCanvasContext(this.canvasId,this);return this.inited=!0,s.scale(r,r),Promise.resolve(s)}var r=(0,g.jq)().pixelRatio;return new Promise((function(t){uni.createSelectorQuery().in(e).select("#".concat(e.canvasId)).node().exec((function(a){var s=a[0].node;e.canvas=s;var o=s.getContext("2d");e.inited||(e.inited=!0,s.width=n*r,s.height=i*r,o.scale(r,r)),t((0,y.y)(o))}))}))},resize:function(){if(this.ctx){var t=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight);this.initialize(),this.ctx.putImageData(t,0,0)}},isCanvasEmpty:function(t){var e=document.createElement("canvas");if(e.width=t.width,e.height=t.height,this.backgroundColor){var n=e.getContext("2d");this.setCanvasBgColor(n)}return t.toDataURL()===e.toDataURL()},setCanvasBgColor:function(t){var e,n;t&&this.backgroundColor&&(t.fillStyle=this.backgroundColor,null===(e=t.setFillStyle)||void 0===e||e.call(t,this.backgroundColor),t.fillRect(0,0,this.canvasWidth,this.canvasHeight),null===(n=t.draw)||void 0===n||n.call(t))},t:m.t}},F=R,L=(n(61093),n(81904)),T=(0,L.A)(F,d,h,!1,null,"2eca66e6",null,!1,a,_),W=T.exports,E=n(98408)["A"],$={"pen-color":"#000","line-width":3,"background-color":"#fff"},B={i18n:{"zh-CN":{penColor:"自定义颜色",lineWidth:"自定义线宽",backgroundColor:"自定义背景颜色"},"en-US":{penColor:"Pen Color",lineWidth:"Line Width",backgroundColor:"Background Color"}},components:{PressSignature:W,PressImage:l.A,PressGrid:u.A,PressGridItem:c.A},data:function(){return{image:"",canvasWidth:"calc(100vw - 16px)",canvasHeight:200,customStyle:"background: transparent",sectionStyle:"padding: 0 0",customInfo:(0,o.A)({},$)}},methods:{onSubmit:function(t){E.log("[onSubmit]",t);var e=t.image,n=t.width,i=t.height;this.image=e,this.canvasWidth=n,this.canvasHeight=i},onClear:function(){},custom:function(t){var e=this;this.customInfo=(0,o.A)((0,o.A)({},$),t),setTimeout((function(){e.$refs.pressSignature.clear()}))}}},M=B,D=(n(1540),(0,L.A)(M,s,r,!1,null,"213370e6",null,!1,i,P)),j=D.exports},78428:function(t,e,n){"use strict";function i(t){return Object.assign(t,{setStrokeStyle:function(e){t.strokeStyle=e},setLineWidth:function(e){t.lineWidth=e},setLineCap:function(e){t.lineCap=e},setFillStyle:function(e){t.fillStyle=e},setFontSize:function(e){t.font=String(e)},setGlobalAlpha:function(e){t.globalAlpha=e},setLineJoin:function(e){t.lineJoin=e},setTextAlign:function(e){t.textAlign=e},setMiterLimit:function(e){t.miterLimit=e},setShadow:function(e,n,i,a){t.shadowOffsetX=e,t.shadowOffsetY=n,t.shadowBlur=i,t.shadowColor=a},setTextBaseline:function(e){t.textBaseline=e},createCircularGradient:function(){},draw:function(){}})}n.d(e,{y:function(){return i}})},581:function(t,e,n){"use strict";n.r(e);var i=n(10809),a=n.n(i),s=n(34114),r=n.n(s),o=r()(a());o.push([t.id,".demo-wrap[data-v-213370e6]{max-height:calc(100vh - 100px)}.image-wrap[data-v-213370e6]{padding:0 8px}",""]),e["default"]=o},48410:function(t,e,n){"use strict";n.r(e);var i=n(10809),a=n.n(i),s=n(34114),r=n.n(s),o=r()(a());o.push([t.id,".press-signature[data-v-2eca66e6]{padding:var(--press-signature-padding,var(--press-padding-xs,8px))}.press-signature__content[data-v-2eca66e6]{display:flex;justify-content:center;align-items:center;height:var(--press-signature-content-height,200px);background-color:var(--press-signature-content-background,var(--press-background-2,#fff));border:var(--press-signature-content-border,1px dotted #dadada);border-radius:var(--press-radius-lg,8px);overflow:hidden}.press-signature__content uni-canvas[data-v-2eca66e6],.press-signature__content Canvas[data-v-2eca66e6]{width:100%;height:100%}.press-signature__footer[data-v-2eca66e6]{display:flex;justify-content:flex-end}.press-signature__footer .press-button[data-v-2eca66e6],.press-signature__footer[data-v-2eca66e6]  .press-signature__button{padding:0 var(--press-padding-md,12px);margin:var(--press-padding-xs,8px)}",""]),e["default"]=o},97255:function(t,e,n){"use strict";var i=n(16922),a=n(11713),s=n(58361);i({target:"Array",proto:!0},{fill:a}),s("fill")},1525:function(t,e,n){"use strict";n.d(e,{A:function(){return a}});n(56359),n(24907),n(9527),n(98756),n(96194),n(98127),n(824),n(56389);var i=n(31136);function a(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=(0,i.A)(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,s=function(){};return{s:s,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(c)throw r}}}}}}]);